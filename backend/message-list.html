<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留言管理后台</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        
        .message-count {
            font-size: 1.1rem;
            color: #7f8c8d;
        }
        
        .message-list {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .message-item {
            border-bottom: 1px solid #eee;
            padding: 20px;
            transition: background-color 0.2s;
        }
        
        .message-item:last-child {
            border-bottom: none;
        }
        
        .message-item:hover {
            background-color: #f9f9f9;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .message-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.2rem;
        }
        
        .message-time {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .message-email {
            color: #3498db;
            margin-bottom: 10px;
            word-break: break-all;
        }
        
        .message-content {
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2rem;
        }
        
        .error {
            background-color: #ffeaea;
            color: #e74c3c;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .no-messages {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2rem;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .message-header {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>留言管理后台</h1>
            <div class="subtitle">查看和管理网站访客留言</div>
        </div>
    </header>
    
    <main class="container">
        <div class="controls">
            <button class="refresh-btn" onclick="loadMessages()">刷新留言</button>
            <div class="message-count">共 <span id="count">0</span> 条留言</div>
        </div>
        
        <div id="error-container"></div>
        
        <div id="loading" class="loading">正在加载留言...</div>
        
        <div id="message-list" class="message-list" style="display: none;">
            <!-- 留言列表将在这里动态生成 -->
        </div>
        
        <div id="no-messages" class="no-messages" style="display: none;">
            暂无留言记录
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p>© 2024 个人简历网站留言系统 | 技术栈：Spring Boot + SQL Server 2022</p>
        </div>
    </footer>

    <script>
        // API基础URL，可根据部署环境修改
        const API_BASE_URL = 'http://localhost:8080/api/resume/message';
        
        // 页面加载完成后自动加载留言
        document.addEventListener('DOMContentLoaded', loadMessages);
        
        // 加载留言列表
        async function loadMessages() {
            const loadingElement = document.getElementById('loading');
            const messageListElement = document.getElementById('message-list');
            const noMessagesElement = document.getElementById('no-messages');
            const errorContainer = document.getElementById('error-container');
            const countElement = document.getElementById('count');
            
            // 显示加载状态
            loadingElement.style.display = 'block';
            messageListElement.style.display = 'none';
            noMessagesElement.style.display = 'none';
            errorContainer.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/list`);
                const result = await response.json();
                
                if (result.code === 200) {
                    const messages = result.data || [];
                    countElement.textContent = messages.length;
                    
                    if (messages.length === 0) {
                        noMessagesElement.style.display = 'block';
                    } else {
                        renderMessages(messages);
                        messageListElement.style.display = 'block';
                    }
                } else {
                    throw new Error(result.msg || '获取留言失败');
                }
            } catch (error) {
                errorContainer.innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
                console.error('加载留言失败:', error);
            } finally {
                loadingElement.style.display = 'none';
            }
        }
        
        // 渲染留言列表
        function renderMessages(messages) {
            const messageListElement = document.getElementById('message-list');
            
            const messagesHtml = messages.map(message => `
                <div class="message-item">
                    <div class="message-header">
                        <div class="message-name">${escapeHtml(message.name)}</div>
                        <div class="message-time">${formatDateTime(message.createTime)}</div>
                    </div>
                    <div class="message-email">${escapeHtml(message.email)}</div>
                    <div class="message-content">${escapeHtml(message.content)}</div>
                </div>
            `).join('');
            
            messageListElement.innerHTML = messagesHtml;
        }
        
        // HTML转义，防止XSS攻击
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 格式化日期时间
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '';
            
            const date = new Date(dateTimeString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
    </script>
</body>
</html>